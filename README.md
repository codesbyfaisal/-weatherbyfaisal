# Netlify Functions

In this tutorial, you will learn how to use Netlify Functions to build and deploy your React application. This function will take a JSON request and return a JSON response. You will also learn how to hide your API key from the client side.

You will not need any server-side code in this tutorial, just a function created in Netlify.

## Prerequisites
- Node.js
- Netlify Account
- GitHub Repository
- Netlify CLI

## Netlify Functions
In this tutorial, we will use Vite to build and deploy our React application.

## Vite Installation
```bash
npm create vite@latest
```

```bash
cd my-project
npm install
npm run dev
```

### Netlify Installation in a CI Environment
This will install the Netlify CLI in your CI environment. It may take time to install depending on your network and system configuration, so don't worry about it.
```bash
npm install netlify-cli --save-dev
```

### Netlify Login
This will prompt you to log in via your default browser.
```bash
npx netlify login
```

### Create Netlify Config File
This will ask you to:
- `Create and deploy site manually`
- Or `Connect this directory with GitHub first`

We will create and deploy the site manually in this tutorial. This will create a `.netlify` directory.
```bash
npx netlify init
```

### Create Functions Directory
```bash
npx netlify functions:create
```
Select `JavaScript` â†’ select `Simple Async Function` â†’ give a name to the file.

```javascript
export default async (req, context) => {
  return new Response("Hello, world!");
};
```

The client API will look like this:

```javascript
fetch('.netlify/functions/hello')
  .then(res => res.text())
  .then(data => console.log(data));
```
You will receive a text response on the client side.

### How to Use the API
`Request`
```javascript
const url = `.netlify/functions/weatherdata?city=${city}`
fetch(url) ....
```

`Netlify Function`
```javascript
export default async (req, context) => {
  const url = new URL(req.url);
  const city = url.searchParams.get('city') || 'World';

  // This will extract the city name from the URL
  const API_KEY = '0e6f4673b9f8af75f397f23f0e23bf4c';

  const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${API_KEY}`);
  const data = await response.json();
  console.log(data);

  return new Response(JSON.stringify(data), {
    headers: { 'Content-Type': 'application/json' }
  });
};
```

### `netlify.toml`
Create a file named `netlify.toml` in your base directory.

Paste this in `netlify.toml`:

```toml
# Global build settings
[build]
  # Default build command to run Vite
  command = "npm run build"

  # Directory that contains the deploy-ready HTML files and assets generated by the build.
  # In a Vite project, this is usually `dist/` unless you've changed it in your Vite config.
  publish = "dist"

# Functions settings
[functions]
  # Directory with serverless functions, relative to the base directory
  directory = ".netlify/functions"

# Local development settings using Netlify Dev
[dev]
  # Command to start the local development server with Vite
  command = "vite"

  # Port for the local development server
  port = 3000

  # Directory to publish during development
  publish = "dist"
```

### Netlify Dev
Run your app in dev mode on your local machine and open it in a browser window.

```bash
npx netlify dev
```

### Netlify Build
This will build your app for production.

```bash
npx netlify build
```

### Netlify Deploy
This will deploy your app.

```bash
npx netlify deploy
```

### Netlify Deploy Functions
This will deploy your app to production, making it public.

```bash
npx netlify deploy --prod
```

## Note
When uploading to GitHub, make sure not to include the `.netlify` directory. I only uploaded it for the tutorial purpose. 
----------------------------------------------
ðŸš€ Happy Coding!